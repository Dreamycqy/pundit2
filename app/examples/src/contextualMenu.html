<!-- buildexamples:section header --><!-- /buildexamples -->

<script>

var ContextualMenuDemoCtrl = function($scope, $rootScope, $dropdown, $timeout, ContextualMenu) {

        var submenuContent = [
            { "text": "Submenu Action1", "href": "#"},
            { "text": "Submenu Action2", "href": "#"}
        ];

        var submenuOver;
        var menuActions = [
            {
                name: 'consoleLog',
                type: 'type1',
                label: "Click to exe console.log",
                showIf: function(){
                    return true;
                },
                action: function(resource){
                    console.log('exe action 2 with resource ', resource);
                }
            },
            {
                label: "This open a submenu",
                name: "subMenuKey",
                type: 'type1',
                showIf: function(){
                    return true;
                },
                hover: function(){
                    var options = {scope: $rootScope.$new()};
                    options.scope.content = submenuContent;
                    // remove submenu inside submenu
                    options.placement = 'right';
                    options.template = 'src/Toolbar/dropdown.tmpl.html';
                    // build menu
                    submenu = $dropdown(angular.element('.dropdown-submenu'), options);
                    submenu.$promise.then(function(){
                        submenu.show();
                        submenu.$element.hover(function(){
                            submenuOver = true;
                        }, function(){
                            submenuOver = false;
                            submenu.hide();
                            submenu.destroy();
                        });
                    });
                },
                leave: function(){
                    $timeout(function() {
                        if ( submenu && !submenuOver) {
                            submenu.hide();
                            submenu.destroy();
                        }
                    }, 100);
                    
                }               
            }
        ];

    $scope.show = function(){
        ContextualMenu.show(250, 100);
    };

    $scope.hide = function($event){
        ContextualMenu.hide();
        $event.stopPropagation();
    };

    var exampleAction = function(){
        console.log('example action execute');
    };

    var l = 0;
    $scope.addAction = function($event){

        if ( l === 0) {
            ContextualMenu.addAction(menuActions[l]);
        } else {
            ContextualMenu.addSubMenu(menuActions[l]);
        }
        l = (l+1) % menuActions.length;
        
        $event.stopPropagation();
    };

    $scope.displayMenu = function($event){
        var resource = {name:'pincopallino'};
        ContextualMenu.show($event.pageX, $event.pageY, resource);
    };

}

</script>

<div data-ng-app="Pundit2" class="pnd-wrp">

    <div class="contexMenu-example-div" ng-controller="ContextualMenuDemoCtrl" ng-click="displayMenu($event)">
        <br><br><br>
        <br><br><br>
        <br><br><br>
        Click addAction button to add custom action (submenu and generic function).<br>
        Now show menu with custom actions.<br>
        Hide (click again or click hide button).<br>
        <br><br><br>

        <button type="button" class="pnd-contexMenu-show-btn btn btn-default" ng-click="show()">Show Menu</button>
        <button type="button" class="pnd-contexMenu-show-btn btn btn-default" ng-click="hide($event)">Hide and Remove Menu</button>
        <button type="button" class="pnd-contexMenu-show-btn btn btn-default" ng-click="addAction($event)">Add Action</button>

    </div>

    <br><br><br>
    <br><br><br>
    <br><br><br>

</div>

<!-- buildexamples:section footer --><!-- /buildexamples -->