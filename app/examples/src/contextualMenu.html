<!-- buildexamples:section header --><!-- /buildexamples -->

<script>

var ContextualMenuDemoCtrl = function($scope, $rootScope, $dropdown, $timeout, ContextualMenu) {

        var submenuContent = [
            { text: "Submenu Action1", "href": "#"},
            { text: "Submenu Action2", "href": "#"}
        ];

        var submenuOver;
        var menuActions = [
            {
                name: 'consoleLog',
                type: ['type1', 'type2'],
                label: "Click to exe console.log",
                priority: 3,
                showIf: function(){
                    return true;
                },
                action: function(resource){
                    console.log('exe action 2 with resource ', resource);
                }
            },
            {
                label: "This open a submenu",
                name: "subMenuKey",
                submenu: true,
                type: ['type2', 'typeSubmenu'],
                priority: 1,
                showIf: function(){
                    return true;
                },
                hover: function(){
                    var options = {scope: $rootScope.$new()};
                    options.scope.content = submenuContent;
                    // remove submenu inside submenu
                    options.placement = ContextualMenu.getSubMenuPlacement();
                    options.template = 'src/Toolbar/dropdown.tmpl.html';
                    // build menu
                    submenu = $dropdown(angular.element('.dropdown-submenu'), options);
                    submenu.$promise.then(function(){
                        submenu.show();
                        submenu.$element.hover(function(){
                            submenuOver = true;
                        }, function(){
                            submenuOver = false;
                            submenu.hide();
                            submenu.destroy();
                        });
                    });
                },
                leave: function(){
                    $timeout(function() {
                        if ( submenu && !submenuOver) {
                            submenu.hide();
                            submenu.destroy();
                        }
                    }, 100);
                    
                }               
            },
            {
                name: 'Action3',
                type: ['type1', 'type99', 'type133'],
                label: "Action3",
                priority: 5,
                showIf: function(){
                    return true;
                },
                action: function(resource){
                    console.log('exe action 3 with resource ', resource);
                }
            },
            {
                name: 'ActionNotDisplayed',
                type: ['type99'],
                label: "ActionNotDisplayed",
                priority: 10,
                showIf: function(){
                    return true;
                },
                action: function(resource){
                    console.log('exe action 3 with resource ', resource);
                }
            }
        ];

    $scope.show = function($event){
        var resource = {name:'pincopallino'};
        ContextualMenu.show(250, 100, resource, ['type1']);
        $event.stopPropagation();
    };

    $scope.showType = function($event){
        var resource = {name:'pincopallino'};
        ContextualMenu.show(450, 100, resource, ['type47']);
        $event.stopPropagation();
    };

    $scope.showOnlySubmenu = function($event){
        var resource = {name:'pincopallino'};
        ContextualMenu.show(550, 100, resource, ['typeSubmenu']);
        $event.stopPropagation();
    };

    $scope.hide = function($event){
        ContextualMenu.hide();
        $event.stopPropagation();
    };

    var exampleAction = function(){
        console.log('example action execute');
    };

    $scope.addAction = function($event){

        for ( l in menuActions ) {
            if ( l === 1) {
                ContextualMenu.addSubMenu(menuActions[l]);
                ContextualMenu.addDivider( { priority:2, type:['type2'] } );
            } else {
                ContextualMenu.addAction(menuActions[l]);
            }
        }
        
        $event.stopPropagation();
    };

    $scope.displayMenu = function($event){
        var resource = {name:'pincopallino'};
        ContextualMenu.show($event.pageX, $event.pageY, resource, ['type1', 'type2']);
    };

}

</script>

<div data-ng-app="Pundit2" class="pnd-wrp">

    <div class="contexMenu-example-div" ng-controller="ContextualMenuDemoCtrl" ng-click="displayMenu($event)">
        <br><br><br>
        <br><br><br>
        <br><br><br>
        Click addAction button to add custom action (repeat to add others action).<br>
        Now show menu with custom actions.<br>
        Hide (click again or click hide button).<br>
        <br><br><br>

        <button type="button" class="pnd-contexMenu-show-btn btn btn-default" ng-click="show($event)">Show Menu</button>
        <button type="button" class="pnd-contexMenu-show-btn btn btn-default" ng-click="hide($event)">Hide and Remove Menu</button>
        <button type="button" class="pnd-contexMenu-show-btn btn btn-default" ng-click="addAction($event)">Add One Action</button>
        <button type="button" class="pnd-contexMenu-show-btn btn btn-default" ng-click="showType($event)">Show Menu With not existing type argument</button>
        <button type="button" class="pnd-contexMenu-show-btn btn btn-default" ng-click="showOnlySubmenu($event)">Show Menu With type submenu</button>

    </div>

</div>

<!-- buildexamples:section footer --><!-- /buildexamples -->